# Watchflow ä¸­æ–‡å®‰è£…æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä»é›¶å¼€å§‹å®‰è£…å’Œè¿è¡Œ Watchflow é¡¹ç›®ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…ï¼š

- **Python 3.12 æˆ–æ›´é«˜ç‰ˆæœ¬**
- **Git**

## ğŸš€ å®‰è£…æ­¥éª¤

### æ­¥éª¤ 1ï¼šå…‹éš†é¡¹ç›®æºç 

æ‰“å¼€å‘½ä»¤è¡Œï¼ˆCMD æˆ– PowerShellï¼‰ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å…‹éš†é¡¹ç›®ï¼š

```bash
git clone https://github.com/IceT5/watchflowlocal.git
cd watchflowlocal
```

### æ­¥éª¤ 2ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒï¼š

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆæ ¹æ®æ‚¨çš„ç³»ç»Ÿé€‰æ‹©ç›¸åº”å‘½ä»¤ï¼‰

# Windows (CMD):
.venv\Scripts\activate.bat

# Windows (PowerShell):
.venv\Scripts\Activate.ps1

# Windows (PowerShell å¦‚æœæ‰§è¡Œç­–ç•¥é™åˆ¶):
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.venv\Scripts\Activate.ps1
```

**æç¤ºï¼š** æ¿€æ´»æˆåŠŸåï¼Œå‘½ä»¤è¡Œå‰é¢ä¼šæ˜¾ç¤º `(.venv)` æ ‡å¿—ã€‚

### æ­¥éª¤ 3ï¼šå®‰è£…é¡¹ç›®ä¾èµ–

åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…é¡¹ç›®åŠå…¶ä¾èµ–ï¼š

```bash
pip install -e ".[dev]"
```

æ­¤å‘½ä»¤å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ç›´åˆ°å®‰è£…å®Œæˆã€‚

### æ­¥éª¤ 4ï¼šé…ç½®ç¯å¢ƒå˜é‡

é¡¹ç›®æä¾›äº† `.env.example` é…ç½®æ–‡ä»¶æ¨¡æ¿ã€‚å¤åˆ¶å®ƒå¹¶åˆ›å»ºå®é™…çš„é…ç½®æ–‡ä»¶ï¼š

```bash
copy .env.example .env
```

ç„¶åç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ VSCodeã€è®°äº‹æœ¬ç­‰ï¼‰æ‰“å¼€ `.env` æ–‡ä»¶ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ã€‚

**é‡è¦é…ç½®é¡¹è¯´æ˜ï¼š**

```bash
# GitHub Personal Access Tokenï¼ˆå¯é€‰ï¼Œæ¨èé…ç½®ï¼‰
# ç”¨äºæé«˜ GitHub API è¯·æ±‚é™åˆ¶ï¼ˆä» 60 æ¬¡/å°æ—¶æå‡åˆ° 5000 æ¬¡/å°æ—¶ï¼‰
# 1. è®¿é—® https://github.com/settings/tokens ç”Ÿæˆ token
# 2. é€‰æ‹© 'repo' æƒé™
# 3. å°†ç”Ÿæˆçš„ token å¤åˆ¶åˆ°ä¸‹é¢
GITHUB_TOKEN=ghp_your_token_here

# AI æä¾›å•†é…ç½®ï¼ˆå¿…éœ€ï¼‰
AI_PROVIDER=openai

# GLM/OpenAI é…ç½®ï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=your_model_name
OPENAI_BASE_URL=your_base_url

# å…¶ä»–é…ç½®é¡¹å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼
```

**æ³¨æ„äº‹é¡¹ï¼š**
- `.env` æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œ**ä¸è¦**å°†å…¶æäº¤åˆ° Git ä»“åº“
- å¦‚æœåªéœ€è¦æµ‹è¯•å¼€æºä»“åº“åˆ†æï¼Œ`GITHUB_TOKEN` å¯ä»¥ä¸é…ç½®ï¼ˆä¼šæœ‰è¯·æ±‚é™åˆ¶ï¼‰
- `OPENAI_API_KEY` æ˜¯å¿…éœ€çš„ï¼Œç”¨äº AI ç›¸å…³åŠŸèƒ½

### æ­¥éª¤ 5ï¼šå¯åŠ¨é¡¹ç›®

åœ¨è™šæ‹Ÿç¯å¢ƒæ¿€æ´»çŠ¶æ€ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼š

```bash
python -m uvicorn src.main:app --reload --host 127.0.0.1 --port 8000
```

**å¯åŠ¨æˆåŠŸåä¼šçœ‹åˆ°ï¼š**

```
INFO:     Will watch for changes in these directories: ['***\watchflowlocal']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using WatchFiles
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
Watchflow application starting up...
INFO:     Application startup complete.
```

### æ­¥éª¤ 6ï¼šéªŒè¯é¡¹ç›®è¿è¡Œ

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä»¥ä¸‹åœ°å€éªŒè¯é¡¹ç›®æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

- **Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñé¡µé¢**: http://127.0.0.1:8000
- **API æ–‡æ¡£**: http://127.0.0.1:8000/docs
- **åˆ†æå™¨é¡µé¢**: http://127.0.0.1:8000/analyzer

## ğŸ§ª æµ‹è¯•é¡¹ç›®è¿è¡Œ

é¡¹ç›®æä¾›äº†æµ‹è¯•è„šæœ¬ã€‚ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼Œè¿è¡Œæµ‹è¯•ï¼š

```bash
# è¿è¡Œç®€å•æµ‹è¯•ï¼ˆå¿«é€Ÿï¼‰
python tests/test_rule_generation_simple_manual.py

# è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œä½¿ç”¨çœŸå®AIåˆ†æï¼‰
python tests/test_rule_generation_manual.py
```

## ğŸ“ å¸¸ç”¨å‘½ä»¤

### å¯åŠ¨æœåŠ¡å™¨

```bash
python -m uvicorn src.main:app --reload --host 127.0.0.1 --port 8000
```

### åœæ­¢æœåŠ¡å™¨

åœ¨å‘½ä»¤è¡Œä¸­æŒ‰ `Ctrl + C` åœæ­¢æœåŠ¡å™¨ã€‚

### é‡æ–°æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

```bash
# Windows (CMD):
.venv\Scripts\activate.bat

# Windows (PowerShell):
.venv\Scripts\Activate.ps1
```

### æ›´æ–°é¡¹ç›®ä¾èµ–

```bash
pip install -e ".[dev]"
```

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šPython ç‰ˆæœ¬ä¸å…¼å®¹

**é”™è¯¯æç¤ºï¼š** `Python ç‰ˆæœ¬è¿‡ä½`

**è§£å†³æ–¹æ¡ˆï¼š**
ç¡®ä¿å®‰è£…äº† Python 3.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æ£€æŸ¥ç‰ˆæœ¬ï¼š

```bash
python --version
```

### é—®é¢˜ 2ï¼šè™šæ‹Ÿç¯å¢ƒæ¿€æ´»å¤±è´¥

**é”™è¯¯æç¤ºï¼š** `æ— æ³•åŠ è½½è„šæœ¬ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦ç”¨äº†è¿è¡Œè„šæœ¬`

**è§£å†³æ–¹æ¡ˆï¼š**

```powershell
# åœ¨ PowerShell ä¸­æ‰§è¡Œ
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

ç„¶åé‡æ–°å°è¯•æ¿€æ´»è™šæ‹Ÿç¯å¢ƒã€‚

### é—®é¢˜ 3ï¼šç«¯å£ 8000 è¢«å ç”¨

**é”™è¯¯æç¤ºï¼š** `Address already in use`

**è§£å†³æ–¹æ¡ˆï¼š**

1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š
```bash
netstat -ano | findstr :8000
```

2. ç»“æŸè¯¥è¿›ç¨‹ï¼š
```bash
taskkill /F /PID <è¿›ç¨‹ID>
```

æˆ–è€…ä½¿ç”¨å…¶ä»–ç«¯å£ï¼š
```bash
python -m uvicorn src.main:app --reload --host 127.0.0.1 --port 8001
```

### é—®é¢˜ 4ï¼šä¾èµ–å®‰è£…å¤±è´¥

**é”™è¯¯æç¤ºï¼š** `pip install å¤±è´¥`

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# å‡çº§ pip
python -m pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒæºåŠ é€Ÿ
pip install -e ".[dev]" -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### é—®é¢˜ 5ï¼š GitHub API è¯·æ±‚é™åˆ¶

**é”™è¯¯æç¤ºï¼š** `GitHub API rate limit exceeded`

**è§£å†³æ–¹æ¡ˆï¼š**

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½® `GITHUB_TOKEN`ï¼š

1. è®¿é—® https://github.com/settings/tokens
2. ç‚¹å‡» "Generate new token" â†’ "Generate new token (classic)"
3. é€‰æ‹© `repo` æƒé™
4. ç”Ÿæˆåå¤åˆ¶ token åˆ° `.env` æ–‡ä»¶çš„ `GITHUB_TOKEN` é…ç½®é¡¹

## ğŸ“š é¡¹ç›®ç»“æ„

```
watchflowlocal/
â”œâ”€â”€ .env                    # ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼ˆä¸æäº¤åˆ° Gitï¼‰
â”œâ”€â”€ .env.example            # ç¯å¢ƒé…ç½®æ¨¡æ¿
â”œâ”€â”€ .watchflow/             # è§„åˆ™é…ç½®ç›®å½•
â”‚   â””â”€â”€ rules.yaml          # è§„åˆ™é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.py             # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ api/                # API æ¥å£
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ integrations/       # ç¬¬ä¸‰æ–¹é›†æˆ
â”‚   â””â”€â”€ ...                 # å…¶ä»–æ¨¡å—
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_rule_generation_manual.py        # å®Œæ•´è§„åˆ™ç”Ÿæˆæµ‹è¯•ï¼ˆçœŸå®AIåˆ†æï¼‰
â”‚   â””â”€â”€ test_rule_generation_simple_manual.py # ç®€å•è§„åˆ™ç”Ÿæˆæµ‹è¯•
â”œâ”€â”€ static/                 # é™æ€æ–‡ä»¶
â”œâ”€â”€ ä¸­æ–‡å®‰è£…æŒ‡å—.md          # ä¸­æ–‡å®‰è£…æŒ‡å—
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜ï¼ˆè‹±æ–‡ï¼‰
```

## ğŸ¯ ä¸‹ä¸€æ­¥

å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. è®¿é—® **http://127.0.0.1:8000/docs** æŸ¥çœ‹ API æ–‡æ¡£
2. è®¿é—® **http://127.0.0.1:8000/analyzer** ä½¿ç”¨è§„åˆ™åˆ†æå™¨
3. æŸ¥çœ‹ `README.md` äº†è§£æ›´å¤šåŠŸèƒ½
4. é˜…è¯» `DEVELOPMENT.md` äº†è§£å¼€å‘ç›¸å…³å†…å®¹

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

- æŸ¥çœ‹ `.env.example` äº†è§£æ‰€æœ‰é…ç½®é€‰é¡¹
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
- ç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½å·²æ­£ç¡®å®‰è£…
- éªŒè¯ `.env` æ–‡ä»¶ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®

## ğŸ“– æ–‡æ¡£

- **é¡¹ç›®è¯´æ˜**: [README.md](README.md)
- **å¼€å‘æŒ‡å—**: [DEVELOPMENT.md](DEVELOPMENT.md)
- **é…ç½®å‚è€ƒ**: [docs/getting-started/configuration.md](docs/getting-started/configuration.md)
- **å¿«é€Ÿå¼€å§‹**: [docs/getting-started/quick-start.md](docs/getting-started/quick-start.md)

---

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰
